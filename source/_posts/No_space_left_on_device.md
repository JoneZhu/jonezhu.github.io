---
title: No space left on device
date: 2026-01-03 01:00:00
categories:
  - æŠ€æœ¯
  - æŠ€æœ¯é—®é¢˜
---

## é—®é¢˜æè¿°

åœ¨ iOS ç«¯å¯¼å…¥å¤§è§†é¢‘æ–‡ä»¶ï¼ˆ5GB+ï¼‰æ—¶ï¼Œiosè®¾å¤‡å­˜å‚¨ç©ºé—´è®¾æ˜¾ç¤ºæœ‰å……è¶³çš„å­˜å‚¨ç©ºé—´ï¼ˆå¦‚ 19GBï¼‰ï¼Œä½†åœ¨å¤åˆ¶è¿‡ç¨‹ä¸­ä»ç„¶ä¼šæŠ¥é”™ï¼š

```
âŒ å†™å…¥å¤±è´¥: No space left on device
ğŸ’¾ å½“å‰å¯ç”¨ç©ºé—´: 17.19 GB  // æ˜æ˜è¿˜æœ‰ç©ºé—´ï¼Œä¸ºä»€ä¹ˆå¤±è´¥ï¼Ÿ
```

å…·ä½“è¡¨ç°ï¼š
- è§†é¢‘å¤åˆ¶åˆ°çº¦ 1.9-2GB æ—¶å¤±è´¥
- ç³»ç»Ÿæ˜¾ç¤ºå‰©ä½™ç©ºé—´å……è¶³ï¼ˆ17-19GBï¼‰
- é”™è¯¯ä¿¡æ¯ï¼š"No space left on device"

---

## æ ¹æœ¬åŸå› 

ç»è¿‡æ·±å…¥åˆ†æï¼Œå‘ç°é—®é¢˜ç”±**ä¸¤ä¸ªå› ç´ **å…±åŒå¯¼è‡´ï¼š

### å› ç´ ä¸€ï¼šiOS å·å®—ï¼ˆVolumeï¼‰åˆ†ç¦»æœºåˆ¶

**å‘ç°è¿‡ç¨‹**ï¼š

åœ¨ iPhone 17 ä¸Šå¤ç°æ­¤é—®é¢˜æ—¶ï¼Œå¯¼è‡´å­˜å‚¨ç©ºé—´æåº¦ç´§å¼ ï¼Œæœ€ç»ˆè§¦å‘äº†æ•´ä¸ª iOS æ–‡ä»¶ç³»ç»Ÿå´©æºƒï¼Œç³»ç»ŸæŠ¥é”™ï¼š

```
âš ï¸ å®—å· User ç©ºé—´ä¸è¶³
```

è¿™ä¸ªå…³é”®é”™è¯¯æç¤ºæ­ç¤ºäº† iOS çš„å·å®—åˆ†ç¦»æœºåˆ¶ã€‚

**æŠ€æœ¯ç»†èŠ‚**ï¼š

iOS æ–‡ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å·å®—ï¼š

| å·å®—ç±»å‹ | ç”¨é€” | ç©ºé—´ç®¡ç† |
|---------|------|----------|
| **ç³»ç»Ÿå·** (System Volume) | å­˜å‚¨ iOS ç³»ç»Ÿæ–‡ä»¶ | ç³»ç»Ÿå ç”¨ï¼Œåªè¯» |
| **æ•°æ®å·** (Data Volume / User Volume) | å­˜å‚¨åº”ç”¨æ•°æ®ã€ç”¨æˆ·æ–‡ä»¶ | åº”ç”¨å¯å†™ |

**å…³é”®ç‚¹**ï¼š
- iOS "è®¾ç½® â†’ é€šç”¨ â†’ iPhone å­˜å‚¨ç©ºé—´" æ˜¾ç¤ºçš„**å¯ç”¨ç©ºé—´æ˜¯ä¸¤ä¸ªå·å®—çš„æ€»å’Œ**
- ä½†åº”ç”¨æ•°æ®**åªèƒ½å†™å…¥æ•°æ®å·**
- å¦‚æœæ•°æ®å·ç©ºé—´ä¸è¶³ï¼Œå³ä½¿ç³»ç»Ÿå·æœ‰ç©ºé—´ï¼Œåº”ç”¨ä¹Ÿæ— æ³•å†™å…¥

**ç¤ºä¾‹**ï¼š
```
è®¾å¤‡æ€»å‰©ä½™ç©ºé—´: 19 GB
â”œâ”€ ç³»ç»Ÿå·å‰©ä½™: 15 GB (åº”ç”¨æ— æ³•ä½¿ç”¨)
â””â”€ æ•°æ®å·å‰©ä½™: 4 GB  (åº”ç”¨å®é™…å¯ç”¨)

å¯¼å…¥ 5GB è§†é¢‘ â†’ å¤±è´¥! (æ•°æ®å·åªæœ‰ 4GB)
```

### å› ç´ äºŒï¼šiCloud è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

**å‘ç°è¿‡ç¨‹**ï¼š

åŸºäºå› ç´ ä¸€è¿›è¡Œä¿®å¤åï¼Œæµ‹è¯•å‘ç°ä»ç„¶æŠ¥é”™ï¼Œä¸”æ­¤æ—¶æ•°æ®å·ç¡®å®æœ‰å……è¶³ç©ºé—´ã€‚äºæ˜¯æ€€ç–‘æ˜¯ iOS ç³»ç»Ÿå¯¹ Documents ç›®å½•çš„ç‰¹æ®Šé™åˆ¶ã€‚

AI å»ºè®®äº†å‡ ä¸ªæ–¹æ¡ˆï¼š
1. Documents å¯èƒ½æœ‰ 2-3GB é™åˆ¶ â†’ **ç«‹å³å¦å®š**ï¼ˆç”¨æˆ·ä¹‹å‰æˆåŠŸå¯¼å…¥è¿‡ 10GB æ–‡ä»¶ï¼‰
2. ä½¿ç”¨ tmp æˆ– Caches ç›®å½• â†’ **ä¸å¯è¡Œ**ï¼ˆå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼‰
3. å¯¹æ¯”ä¸­å‘ç°å…³é”®ä¿¡æ¯ï¼š**Documents ä¼šè‡ªåŠ¨å¤‡ä»½åˆ° iCloud**

**æŠ€æœ¯ç»†èŠ‚**ï¼š

iOS Documents ç›®å½•çš„ç‰¹æ€§ï¼š
- é»˜è®¤ä¼šè¢« iCloud è‡ªåŠ¨å¤‡ä»½
- å†™å…¥æ–‡ä»¶æ—¶ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥ **iCloud å‰©ä½™ç©ºé—´**
- å¦‚æœæ–‡ä»¶å¤§å° > iCloud å‰©ä½™ç©ºé—´ â†’ å†™å…¥å¤±è´¥

**å®é™…æ¡ˆä¾‹**ï¼š
```
æ•°æ®å·å‰©ä½™ç©ºé—´: 20 GB âœ…
iCloud å‰©ä½™ç©ºé—´: 2 GB  âŒ

å¯¼å…¥ 5GB è§†é¢‘ â†’ å¤±è´¥!
åŸå› : iCloud ç©ºé—´ä¸è¶³ï¼Œæ— æ³•å¤‡ä»½è¯¥æ–‡ä»¶
```

---

## è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

é€šè¿‡ä¸¤æ­¥ä¼˜åŒ–å½»åº•è§£å†³é—®é¢˜ï¼š

1. **äº‹å‰æ£€æŸ¥æ•°æ®å·ç©ºé—´** - é¿å…æµªè´¹ç”¨æˆ·æ—¶é—´
2. **ç¦ç”¨ iCloud å¤‡ä»½** - ç§»é™¤ iCloud ç©ºé—´é™åˆ¶

### å®ç°ç»†èŠ‚

#### 1. æ£€æŸ¥æ•°æ®å·å¯ç”¨ç©ºé—´

åœ¨å¯¼å…¥å‰ï¼Œä½¿ç”¨ Apple æ¨èçš„ API æ£€æŸ¥**æ•°æ®å·**çš„å®é™…å¯ç”¨ç©ºé—´ï¼š

```swift
// è·å–æ•°æ®å·çš„å¯ç”¨ç©ºé—´ï¼ˆç”¨äºé‡è¦æ“ä½œï¼‰
let resourceValues = try documentsDirectory.resourceValues(
    forKeys: [.volumeAvailableCapacityForImportantUsageKey]
)

if let availableBytes = resourceValues.volumeAvailableCapacityForImportantUsage {
    let availableGB = Double(availableBytes) / 1024.0 / 1024.0 / 1024.0
    logger.info("ğŸ’¾ æ•°æ®å·å¯ç”¨ç©ºé—´: \(String(format: "%.2f", availableGB)) GB")

    // é¢„ç•™ 1.5 å€ç©ºé—´ï¼ˆè€ƒè™‘åç»­å¤„ç†éœ€è¦çš„ç¼“å­˜ï¼‰
    let requiredSpace = Int64(Double(sourceFileSize) * 1.5)

    if availableBytes < requiredSpace {
        // æå‰å‘ŠçŸ¥ç”¨æˆ·ç©ºé—´ä¸è¶³ï¼Œé¿å…æµªè´¹æ—¶é—´
        throw InsufficientStorageError(
            required: requiredSpace,
            available: availableBytes
        )
    }
}
```

**ä¸ºä»€ä¹ˆä½¿ç”¨ `volumeAvailableCapacityForImportantUsageKey`ï¼Ÿ**

Apple æä¾›äº†ä¸‰ç§å­˜å‚¨ç©ºé—´æŸ¥è¯¢ APIï¼š

| API | ç”¨é€” | å‡†ç¡®æ€§ |
|-----|------|--------|
| `.volumeAvailableCapacityKey` | æ™®é€šæ“ä½œ | ä¿å®ˆä¼°è®¡ |
| `.volumeAvailableCapacityForImportantUsageKey` | **é‡è¦æ“ä½œ** | **æœ€å‡†ç¡®** âœ… |
| `.volumeAvailableCapacityForOpportunisticUsageKey` | æœºä¼šæ€§æ“ä½œ | æœ€ä¿å®ˆ |

å¯¹äºå¤§æ–‡ä»¶å¯¼å…¥è¿™ç§**é‡è¦æ“ä½œ**ï¼Œåº”ä½¿ç”¨ `ForImportantUsage` è·å–æœ€å‡†ç¡®çš„å¯ç”¨ç©ºé—´ã€‚

#### 2. ç¦ç”¨ iCloud å¤‡ä»½

å°†æ–‡ä»¶æ ‡è®°ä¸º"ä¸å¤‡ä»½åˆ° iCloud"ï¼š

```swift
// æ–¹å¼1: åœ¨æ–‡ä»¶åˆ›å»ºåç«‹å³æ ‡è®°ï¼ˆæ¨èï¼‰
let destinationURL = documentsDirectory.appendingPathComponent("import/videos/\(fileName).mp4")

// åˆ›å»ºæ–‡ä»¶
FileManager.default.createFile(atPath: destinationURL.path, contents: nil, attributes: nil)

// ç«‹å³æ ‡è®°ä¸å¤‡ä»½
var resourceValues = URLResourceValues()
resourceValues.isExcludedFromBackup = true
var mutableURL = destinationURL
try mutableURL.setResourceValues(resourceValues)

logger.info("âœ… å·²æ ‡è®°æ–‡ä»¶ä¸å¤‡ä»½åˆ°iCloud")

// ç„¶åå†å†™å…¥å¤§é‡æ•°æ®...
```

**å…³é”®ç‚¹**ï¼š
- `isExcludedFromBackup = true` å‘Šè¯‰ç³»ç»Ÿä¸è¦å¤‡ä»½è¯¥æ–‡ä»¶
- è¿™æ ·å†™å…¥æ—¶å°±ä¸ä¼šæ£€æŸ¥ iCloud ç©ºé—´
- é€‚åˆä¸´æ—¶å¯¼å…¥ã€å¯é‡æ–°è·å–çš„å¤§æ–‡ä»¶

---


## æµ‹è¯•éªŒè¯

### æµ‹è¯•ç¯å¢ƒ
- è®¾å¤‡ï¼šiPhone 17
- iOS ç‰ˆæœ¬ï¼šiOS 18+
- æµ‹è¯•æ–‡ä»¶ï¼š5001 MB è§†é¢‘

### ä¿®å¤å‰

```
ğŸ’¾ å¯ç”¨å­˜å‚¨ç©ºé—´: 19.09 GB  â† æ˜¾ç¤ºçš„æ˜¯ç³»ç»Ÿå·+æ•°æ®å·æ€»å’Œ
ğŸ“Š æºè§†é¢‘æ–‡ä»¶å¤§å°: 5001.30 MB
ğŸ”„ å¼€å§‹åˆ†å—å¤åˆ¶æ–‡ä»¶
ğŸ“Š å·²å¤åˆ¶ 10 MB...
ğŸ“Š å·²å¤åˆ¶ 1910 MB...
ğŸ“Š å·²å¤åˆ¶ 1920 MB...
ğŸ“Š å·²å¤åˆ¶ 1947 MB...
âŒ å†™å…¥å¤±è´¥: è¯»å– 1048576 å­—èŠ‚ï¼Œä½†åªå†™å…¥ -1 å­—èŠ‚
âŒ å†™å…¥æµé”™è¯¯: No space left on device
ğŸ’¾ å½“å‰å¯ç”¨ç©ºé—´: 17.19 GB  â† ä»æœ‰ç©ºé—´ï¼Œä½†å¤±è´¥äº†
```

**å¤±è´¥åŸå› **ï¼š
1. æ•°æ®å·å®é™…åªæœ‰ ~2GB å¯ç”¨ç©ºé—´
2. iCloud å‰©ä½™ç©ºé—´ä¸è¶³ 5GB

### ä¿®å¤å

```
ğŸ’¾ æ•°æ®å·å¯ç”¨ç©ºé—´: 20.15 GB  â† å‡†ç¡®æ£€æŸ¥æ•°æ®å·
ğŸ“Š æºè§†é¢‘æ–‡ä»¶å¤§å°: 5001.30 MB
âœ… ç©ºé—´å……è¶³ï¼Œå¯ä»¥ç»§ç»­
âœ… å·²æ ‡è®°æ–‡ä»¶ä¸å¤‡ä»½åˆ°iCloud  â† ä¸å— iCloud ç©ºé—´é™åˆ¶
ğŸ”„ å¼€å§‹åˆ†å—å¤åˆ¶æ–‡ä»¶
ğŸ“Š å·²å¤åˆ¶ 10 MB...
ğŸ“Š å·²å¤åˆ¶ 1000 MB...
ğŸ“Š å·²å¤åˆ¶ 2000 MB...
ğŸ“Š å·²å¤åˆ¶ 3000 MB...
ğŸ“Š å·²å¤åˆ¶ 4000 MB...
ğŸ“Š å·²å¤åˆ¶ 5000 MB...
âœ… å¤åˆ¶å®Œæˆï¼Œæ€»è®¡ 5001 MB
âœ… æ–‡ä»¶éªŒè¯æˆåŠŸï¼Œå¤§å°: 5001.30 MB
âœ… å¯¼å…¥æˆåŠŸï¼
```

---

## æŠ€æœ¯æ€»ç»“

### é—®é¢˜æœ¬è´¨

iOS å¤§æ–‡ä»¶å¯¼å…¥å¤±è´¥çš„ä¸¤ä¸ªæ ¹æœ¬åŸå› ï¼š

1. **å·å®—åˆ†ç¦»**ï¼šè®¾å¤‡æ˜¾ç¤ºçš„å¯ç”¨ç©ºé—´ â‰  åº”ç”¨å®é™…å¯ç”¨ç©ºé—´
2. **iCloud å¤‡ä»½**ï¼šDocuments æ–‡ä»¶ä¼šè§¦å‘ iCloud ç©ºé—´æ£€æŸ¥

### è§£å†³æ–¹æ¡ˆæ ¸å¿ƒ

1. **ç²¾ç¡®æ£€æŸ¥**ï¼šä½¿ç”¨ `volumeAvailableCapacityForImportantUsageKey` æ£€æŸ¥æ•°æ®å·å¯ç”¨ç©ºé—´
2. **ç¦ç”¨å¤‡ä»½**ï¼šè®¾ç½® `isExcludedFromBackup = true` é¿å… iCloud é™åˆ¶

### æœ€ä½³å®è·µ

**ä½•æ—¶ä½¿ç”¨ `isExcludedFromBackup = true`ï¼Ÿ**

âœ… **åº”è¯¥ä½¿ç”¨**ï¼š
- ä¸´æ—¶å¯¼å…¥çš„å¤§æ–‡ä»¶
- å¯ä»¥é‡æ–°ä¸‹è½½/è·å–çš„æ•°æ®
- ç¼“å­˜æ–‡ä»¶ã€ä¸­é—´å¤„ç†æ–‡ä»¶
- ç”¨æˆ·ä¸éœ€è¦è·¨è®¾å¤‡åŒæ­¥çš„æ•°æ®

âŒ **ä¸åº”ä½¿ç”¨**ï¼š
- ç”¨æˆ·åˆ›å»ºçš„æ–‡æ¡£ã€ç…§ç‰‡
- æ— æ³•é‡æ–°è·å–çš„æ•°æ®
- éœ€è¦è·¨è®¾å¤‡åŒæ­¥çš„å†…å®¹

**å­˜å‚¨ç›®å½•é€‰æ‹©**ï¼š

| ç›®å½• | å¤‡ä»½ | æ¸…ç† | é€‚åˆåœºæ™¯ |
|-----|------|------|---------|
| `Documents/` | é»˜è®¤å¤‡ä»½ | æ°¸ä¹… | ç”¨æˆ·æ–‡æ¡£ï¼ˆå°æ–‡ä»¶ï¼‰ |
| `Documents/` + `isExcludedFromBackup` | ä¸å¤‡ä»½ âœ… | æ°¸ä¹… | **ä¸´æ—¶å¯¼å…¥å¤§æ–‡ä»¶** âœ… |
| `Library/Caches/` | ä¸å¤‡ä»½ | ç©ºé—´ä¸è¶³æ—¶ | å¯é‡æ–°ä¸‹è½½çš„ç¼“å­˜ |
| `tmp/` | ä¸å¤‡ä»½ | åº”ç”¨é€€å‡ºå | ä¸´æ—¶å¤„ç†æ–‡ä»¶ |

---

## å‚è€ƒèµ„æ–™

- [Apple File System Programming Guide](https://developer.apple.com/library/archive/documentation/FileManagement/Conceptual/FileSystemProgrammingGuide/)
- [URLResourceKey - volumeAvailableCapacityForImportantUsageKey](https://developer.apple.com/documentation/foundation/urlresourcekey/2877679-volumeavailablecapacityforimpor)
- [URLResourceValues - isExcludedFromBackup](https://developer.apple.com/documentation/foundation/urlresourcevalues/1779742-isexcludedfrombackup)
- [iOS Data Storage Guidelines](https://developer.apple.com/icloud/documentation/data-storage/)

